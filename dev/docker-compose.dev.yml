# ── Dev Override: Mount host-built binaries into containers ────────
#
# Usage:
#   cargo build -p strata-agent -p strata-control -p strata-gst
#   docker compose -f docker-compose.yml -f dev/docker-compose.dev.yml up -d
#
# Rebuild a crate and restart its container:
#   cargo build -p strata-control && docker compose restart strata-control
#   cargo build -p strata-agent  && docker compose restart strata-sender-sim
#   cargo build -p strata-gst    && docker compose restart strata-sender-sim strata-receiver
#
# For web development (dashboard / portal) use the hot-reload profile
# instead — no manual builds or restarts needed:
#   docker compose --profile web-dev up dashboard-dev
#   docker compose --profile web-dev up portal-dev
#
# The host dev container and the Docker runtime are both Debian 12
# (bookworm) with identical GStreamer 1.22 packages, so the binaries
# are directly compatible.
#
# ⚠ For production images, use the normal `docker compose build`.

services:
  strata-control:
    volumes:
      - ${PWD}/target/debug/strata-control:/usr/local/bin/strata-control:ro

  strata-sender-sim:
    volumes:
      - ${PWD}/target/debug/strata-agent:/usr/local/bin/strata-agent:ro
      - ${PWD}/target/debug/strata-node:/usr/local/bin/strata-node:ro
      - ${PWD}/target/debug/libgststrata.so:/usr/lib/x86_64-linux-gnu/gstreamer-1.0/libgststrata.so:ro

  strata-receiver:
    volumes:
      - ${PWD}/target/debug/strata-node:/usr/local/bin/strata-node:ro
      - ${PWD}/target/debug/libgststrata.so:/usr/lib/x86_64-linux-gnu/gstreamer-1.0/libgststrata.so:ro
